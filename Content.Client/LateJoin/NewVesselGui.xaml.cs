using System.Linq;
using Content.Client.Maps;
using Content.Client.UserInterface;
using Robust.Client.AutoGenerated;
using Robust.Client.UserInterface.Controls;
using Robust.Client.UserInterface.XAML;
using Robust.Shared.Console;
using Robust.Shared.Prototypes;

namespace Content.Client.LateJoin;

[GenerateTypedNameReferences]
public sealed partial class NewVesselGui : FancyWindow
{
    [Dependency] private readonly IPrototypeManager _prototypeManager = default!;
    [Dependency] private readonly IConsoleHost _consoleHost = default!;

    public NewVesselGui()
    {
        IoCManager.InjectDependencies(this);
        RobustXamlLoader.Load(this);
        foreach (var map in _prototypeManager.EnumeratePrototypes<GameMapPrototype>())
        {
            if (!map.Votable)
                continue;

            ShuttleList.Add(new ItemList.Item(ShuttleList)
            {
                Text = map.MapName,
                Metadata = map.ID
            });
        }

        ShuttleList.OnItemSelected += ShuttleListOnOnItemSelected;
        PurchaseShipButton.OnPressed += PurchaseShipButtonOnOnPressed;
    }

    private void PurchaseShipButtonOnOnPressed(BaseButton.ButtonEventArgs obj)
    {
        _consoleHost.ExecuteCommand($"purchaseship {(string)ShuttleList.GetSelected().First().Metadata!}");
        Close();
    }

    private void ShuttleListOnOnItemSelected(ItemList.ItemListSelectedEventArgs obj)
    {
        PurchaseShipButton.Disabled = false;
    }
}
